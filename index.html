<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Street Dodger</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 100px auto; }
    </style>
</head>
<body>

<canvas id="sdCanvas" width="800" height="500"></canvas>

<script>
  // Variable delarations & Assignments
  //
  const canvas = document.getElementById("sdCanvas");
	const ctx = canvas.getContext("2d");

  var pedestrianX = 820;
  var pedestrianY = 400;

  var playerX = 100;
  var playerY = 400;

  var dodgeKeyX = 800;
  var dodgeKeyY = 50;

  var dodgeZoneX = 150;
  var dodgeZoneY = 50;

  var dx = -1;
  var dy = 0;

  var keyPresses = {
    qPressed: false,
    wPressed: false,
    ePressed: false,
    rPressed: false
  };

  var dodgeZoneColor = "blue";
  //

  // Key Bindings Setup
  //
  document.addEventListener("keydown", keyDownHandler, false);
  document.addEventListener("keyup", keyUpHandler, false);

  function keyDownHandler(e) {
    // console.log("keyDownHandler called");
    switch (e.keyCode) {
      case 81:
        keyPresses["qPressed"] = true;
        break;
      case 87:
        keyPresses["wPressed"] = true;
        break;
      case 69:
        keyPresses["ePressed"] = true;
        break;
      case 82:
        keyPresses["rPressed"] = true;
        break;
    }
  };

  function keyUpHandler(e) {
    switch (e.keyCode) {
      case 81:
        keyPresses["qPressed"] = false;
        break;
      case 87:
        keyPresses["wPressed"] = false;
        break;
      case 69:
        keyPresses["ePressed"] = false;
        break;
      case 82:
        keyPresses["rPressed"] = false;
        break;
    }
  };

  function colorDodgeWindow () {
    for (var key in keyPresses) {
      if (keyPresses.hasOwnProperty(key)) {
        if (keyPresses[key] === true) {
          dodgeZoneColor = "yellow";
          return;
        }
      }
    }

    dodgeZoneColor = "blue";
  }
  //

  // Element Draw Logic
  //
  const walkerWidth = 30;
  const walkerHeight = 50;

  function drawPedestrian () {
    ctx.beginPath();
    ctx.rect(pedestrianX, pedestrianY, walkerWidth, walkerHeight);
    ctx.fillStyle = "red";
    ctx.fill();
    ctx.closePath();
  }

  function drawPlayer () {
    ctx.beginPath();
    ctx.rect(playerX, playerY, walkerWidth, walkerHeight);
    ctx.fillStyle = "blue";
    ctx.fill();
    ctx.closePath();
  }

  function drawDodgeKey () {
    ctx.beginPath();
    ctx.rect(dodgeKeyX, dodgeKeyY, 50, 50);
    ctx.fillStyle = "green";
    ctx.fill();
    ctx.closePath();
  }

  function drawDodgeWindow () {
    ctx.beginPath();
    ctx.rect(dodgeZoneX, dodgeZoneY, 50, 50);
    ctx.strokeStyle = dodgeZoneColor;
    ctx.stroke();
    ctx.closePath();
  }
  //

  // Collision Detection
  //
  function dodgeKeyIsCollidedWithWindow () {
    if (dodgeKeyX > dodgeZoneX - 50 && dodgeKeyX < (dodgeZoneX + 50)) {
      console.log('collision!')
      return true;
    }
  }

  // Master Draw Logic
  //
  function draw () {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawPlayer();
    drawPedestrian();

    colorDodgeWindow();
    drawDodgeWindow();

    drawDodgeKey();

    dodgeKeyIsCollidedWithWindow();

    pedestrianX += dx;
    pedestrianY += dy;
    dodgeKeyX += dx;
    dodgeKeyY += dy;
    window.requestAnimationFrame(this.draw);
  }
  //

  // Animation
  //
  draw();
  //
</script>

</body>
</html>
